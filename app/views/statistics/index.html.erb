<div class="container-fluid py-4">
  <div class="row">
    <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="col-12 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h1 class="h3 mb-3">ğŸ“Š ã‚ãªãŸã®çµ±è¨ˆæƒ…å ±</h1>
              <p class="text-muted mb-0">ãƒ©ã‚¸ã‚ªä½“æ“ã®å‚åŠ çŠ¶æ³ã‚’è©³ã—ãåˆ†æã—ã¦ã¿ã¾ã—ã‚‡ã†</p>
            </div>
            <div>
              <%= link_to badges_path, class: "btn btn-outline-primary" do %>
                ğŸ† ãƒãƒƒã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div class="col-12 mb-4">
      <div class="card border-0 shadow-sm bg-gradient-primary text-white">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="flex-shrink-0 me-3">
              <span class="fs-1">ğŸ’ª</span>
            </div>
            <div class="flex-grow-1">
              <h5 class="card-title mb-2">ä»Šæ—¥ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</h5>
              <p class="card-text mb-0"><%= @motivational_message %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- åŸºæœ¬çµ±è¨ˆ -->
    <div class="col-lg-3 col-md-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-primary mb-3">
            <span class="fs-1">ğŸ¯</span>
          </div>
          <h5 class="card-title">ç·ã‚¹ã‚¿ãƒ³ãƒ—æ•°</h5>
          <h2 class="text-primary mb-0"><%= @current_user_stats[:total_stamps] %></h2>
          <small class="text-muted">å›å‚åŠ </small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-warning mb-3">
            <span class="fs-1">ğŸ”¥</span>
          </div>
          <h5 class="card-title">ç¾åœ¨ã®é€£ç¶šè¨˜éŒ²</h5>
          <h2 class="text-warning mb-0"><%= @current_user_stats[:consecutive_days] %></h2>
          <small class="text-muted">æ—¥é€£ç¶š</small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-success mb-3">
            <span class="fs-1">ğŸ“…</span>
          </div>
          <h5 class="card-title">ä»Šæœˆã®å‚åŠ ç‡</h5>
          <h2 class="text-success mb-0"><%= @current_user_stats[:participation_rate_this_month].round(1) %>%</h2>
          <small class="text-muted"><%= @current_user_stats[:current_month_stamps] %>/<%= Date.current.day %> æ—¥</small>
        </div>
      </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="text-info mb-3">
            <span class="fs-1">â°</span>
          </div>
          <h5 class="card-title">å¹³å‡å‚åŠ æ™‚åˆ»</h5>
          <h2 class="text-info mb-0"><%= @current_user_stats[:average_participation_time] || "---" %></h2>
          <small class="text-muted">å¹³å‡æ™‚åˆ»</small>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- å®Ÿç¸¾ãƒ»ãƒãƒƒã‚¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="col-lg-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">ğŸ† ã‚ãªãŸã®å®Ÿç¸¾</h5>
        </div>
        <div class="card-body">
          <% if @achievements.any? %>
            <% @achievements.each do |achievement| %>
              <div class="d-flex align-items-center mb-3 p-3 bg-light rounded">
                <div class="flex-shrink-0 me-3">
                  <span class="fs-3"><%= achievement[:icon] %></span>
                </div>
                <div class="flex-grow-1">
                  <h6 class="mb-1"><%= achievement[:title] %></h6>
                  <p class="text-muted mb-0 small"><%= achievement[:description] %></p>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="text-center text-muted py-4">
              <span class="fs-1">ğŸŒ±</span>
              <p class="mt-2">ã¾ã å®Ÿç¸¾ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ç¶™ç¶šã—ã¦å‚åŠ ã™ã‚‹ã¨å®Ÿç¸¾ãŒç²å¾—ã§ãã¾ã™ï¼</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- è©³ç´°çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="col-lg-6 mb-4">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-header bg-transparent border-0">
          <h5 class="mb-0">ğŸ“ˆ è©³ç´°çµ±è¨ˆ</h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6 mb-3">
              <h6 class="text-muted mb-1">ä»Šå¹´ã®å‚åŠ æ•°</h6>
              <h4 class="text-primary"><%= @current_user_stats[:current_year_stamps] %></h4>
            </div>
            <div class="col-6 mb-3">
              <h6 class="text-muted mb-1">ä»Šå¹´ã®å‚åŠ ç‡</h6>
              <h4 class="text-success"><%= @current_user_stats[:participation_rate_this_year].round(1) %>%</h4>
            </div>
            <div class="col-6 mb-3">
              <h6 class="text-muted mb-1">æœ€é•·é€£ç¶šè¨˜éŒ²</h6>
              <h4 class="text-warning"><%= @current_user_stats[:longest_streak] %></h4>
            </div>
            <div class="col-6 mb-3">
              <h6 class="text-muted mb-1">å‚åŠ é–‹å§‹æ—¥</h6>
              <h6 class="text-info"><%= current_user.created_at.strftime("%Y/%m/%d") %></h6>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- æœˆæ¬¡çµ±è¨ˆã‚°ãƒ©ãƒ• -->
  <div class="row">
    <div class="col-12 mb-4">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ğŸ“Š æœˆæ¬¡å‚åŠ çŠ¶æ³ï¼ˆéå»12ãƒ¶æœˆï¼‰</h5>
          <%= link_to "è©³ç´°ã‚’è¦‹ã‚‹", monthly_statistics_path, class: "btn btn-outline-primary btn-sm" %>
        </div>
        <div class="card-body">
          <canvas id="monthlyChart" width="400" height="200"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- å¹´æ¬¡çµ±è¨ˆã‚°ãƒ©ãƒ• -->
  <% if @yearly_data.length > 1 %>
    <div class="row">
      <div class="col-12 mb-4">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
            <h5 class="mb-0">ğŸ“ˆ å¹´æ¬¡å‚åŠ çŠ¶æ³</h5>
            <%= link_to "è©³ç´°ã‚’è¦‹ã‚‹", yearly_statistics_path, class: "btn btn-outline-primary btn-sm" %>
          </div>
          <div class="card-body">
            <canvas id="yearlyChart" width="400" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
  <div class="row">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body text-center">
          <h5 class="mb-3">ã•ã‚‰ã«è©³ã—ã„çµ±è¨ˆã‚’è¦‹ã‚‹</h5>
          <div class="d-flex justify-content-center gap-3">
            <%= link_to monthly_statistics_path, class: "btn btn-primary" do %>
              ğŸ“… æœˆæ¬¡çµ±è¨ˆ
            <% end %>
            <%= link_to yearly_statistics_path, class: "btn btn-success" do %>
              ğŸ“Š å¹´æ¬¡çµ±è¨ˆ
            <% end %>
            <%= link_to stamp_cards_path, class: "btn btn-outline-primary" do %>
              ğŸƒâ€â™‚ï¸ ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰ã«æˆ»ã‚‹
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.jsçµ±åˆ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// æœˆæ¬¡çµ±è¨ˆã‚°ãƒ©ãƒ•
const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
const monthlyChart = new Chart(monthlyCtx, {
    type: 'line',
    data: {
        labels: [<%= @monthly_data.map { |m| "'#{m[:month].strftime('%Y/%m')}'" }.join(', ').html_safe %>],
        datasets: [{
            label: 'å‚åŠ æ•°',
            data: [<%= @monthly_data.map { |m| m[:stamp_count] }.join(', ') %>],
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.1
        }, {
            label: 'å‚åŠ ç‡ (%)',
            data: [<%= @monthly_data.map { |m| m[:participation_rate] }.join(', ') %>],
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            yAxisID: 'y1',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'æœˆæ¬¡å‚åŠ çŠ¶æ³ã®æ¨ç§»'
            },
            legend: {
                display: true
            }
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                    display: true,
                    text: 'å‚åŠ æ•°'
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                    display: true,
                    text: 'å‚åŠ ç‡ (%)'
                },
                grid: {
                    drawOnChartArea: false,
                },
                max: 100
            }
        }
    }
});

<% if @yearly_data.length > 1 %>
// å¹´æ¬¡çµ±è¨ˆã‚°ãƒ©ãƒ•
const yearlyCtx = document.getElementById('yearlyChart').getContext('2d');
const yearlyChart = new Chart(yearlyCtx, {
    type: 'bar',
    data: {
        labels: [<%= @yearly_data.map { |y| "'#{y[:year]}å¹´'" }.join(', ').html_safe %>],
        datasets: [{
            label: 'å¹´é–“å‚åŠ æ•°',
            data: [<%= @yearly_data.map { |y| y[:stamp_count] }.join(', ') %>],
            backgroundColor: 'rgba(54, 162, 235, 0.2)',
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'å¹´æ¬¡å‚åŠ æ•°ã®æ¨ç§»'
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                title: {
                    display: true,
                    text: 'å‚åŠ æ•°'
                }
            }
        }
    }
});
<% end %>
</script>