# PR自動化システム

## 概要
Radio-CalisthenicsプロジェクトのPR作成とコミット標準化設定について説明します。

## PR・コミット標準化設定

### PR作成テンプレート管理

#### 🤖 推奨: 自動PR文章生成システム（デフォルト）
**「pushまで行ってください」の一言で高品質なPR文章が自動生成されます**

Claude Codeが実装内容を自動分析し、詳細で包括的なPR文章を生成：
- Git差分分析による変更内容の自動抽出
- 機能分類に応じた詳細説明・影響範囲分析
- 品質チェック結果の統合表示
- 自動レビューポイント識別・実機テスト推奨項目

**使用方法**: 実装完了後に「pushまで行ってください」「プルリクまで作成してください」と指示するだけ

#### 📝 手動テンプレート（特殊用途）
**特別な要件がある場合のみ使用してください**

`.github/pull_request_template_legacy.md` から手動でコピー&ペースト可能：

**基本セクション**
- 概要（Notion・Figma URL・背景説明）
- 細かな変更点（箇条書き）
- スクリーンショット（Before/After テーブル）
- 影響範囲・懸念点
- 動作確認（チェックリスト）
- その他（レビュアーメッセージ）

#### 🔄 使い分けガイド

**自動生成システムを使用する場合（推奨）**:
- 通常の機能実装・バグ修正・リファクタリング
- Claude Codeによる実装作業
- 詳細で一貫性のあるPR文章が必要
- 開発効率を重視

**手動テンプレートを使用する場合**:
- 外部ツール・手動実装による変更
- 特殊な要件・カスタマイズが必要
- AI分析が困難な変更内容
- 企画・設計段階のドキュメント更新

## PR自動作成設定

### 🎯 自動PR生成システム（実装済み）
プッシュ時に以下が自動実行されます：
- **pre-pushフック**: `git push` 時に自動トリガー
- **PR説明文生成**: Git差分分析による詳細内容生成
- **GitHub PR作成**: `gh pr create` による自動PR作成
- **品質管理**: 重複PR防止・エラーハンドリング完備

### 自動PR分析・生成システム
Claude Codeが以下の手順で詳細なPR文章を自動生成：

```bash
# Step 1: 実装内容の自動分析
git diff --name-status HEAD~1 HEAD    # 変更ファイル検出
git log --oneline -1                  # 最新コミット分析
git diff --stat HEAD~1 HEAD           # 変更統計取得

# Step 2: 機能分類の自動判定
- 新機能実装 (feat:) → 詳細機能説明・技術仕様・影響範囲を生成
- バグ修正 (fix:) → 問題説明・解決方法・検証方法を生成  
- リファクタリング (refactor:) → 改善点・性能影響・互換性を生成
- スタイル修正 (style:) → 品質改善・基準準拠・自動修正内容を生成

# Step 3: 高品質PR文章の自動生成
gh pr create --title "[自動生成タイトル]" --body "$(generate_detailed_pr_body)"
```

### 自動生成されるPR文章の内容

**🎯 概要セクション**
- プロジェクト背景とこの実装の位置づけ
- 実現する機能の詳細説明  
- 技術的なアプローチとその理由
- ユーザーへの価値提供

**🔧 細かな変更点セクション**
- 新規ファイル詳細 (ファイル数・行数・機能説明)
- 修正ファイル詳細 (変更理由・影響範囲・リスク評価)
- 技術実装詳細 (アーキテクチャ・ライブラリ・設計判断)
- UI/UX変更詳細 (レスポンシブ対応・アクセシビリティ・ユーザビリティ)

**⚠️ 影響範囲・懸念点セクション**
- 既存機能への影響分析
- パフォーマンス影響評価
- セキュリティ考慮事項
- データベース変更影響
- 外部依存関係の影響

**✅ 動作確認セクション**
- 機能別テスト項目 (実装内容に応じて自動生成)
- 品質チェック項目 (RuboCop・RSpec・セキュリティ)
- クロスブラウザ確認項目 (UI変更時)
- パフォーマンステスト項目 (重要変更時)

**📊 技術的成果セクション**
- コード統計 (新規行数・修正行数・削除行数)
- 品質指標 (テスト通過率・Lint準拠率)
- 今後の拡張性考慮
- メンテナンス性向上点

## 実装分類別の自動生成ロジック

### 新機能実装 (feat:) の場合
```bash
# 自動生成される内容
- Phase情報の抽出と背景説明
- MVC各層の実装詳細
- データベース設計への影響
- ユーザーストーリーとの対応
- セキュリティ・パフォーマンス考慮
- 今後の拡張計画
```

### UI/UX改善の場合
```bash
# 自動生成される内容  
- デザインシステムとの整合性
- レスポンシブ対応詳細
- アクセシビリティ対応
- ユーザビリティテスト項目
- クロスブラウザ対応確認
```

### API・バックエンド変更の場合
```bash
# 自動生成される内容
- API仕様変更の詳細
- パフォーマンス影響分析
- セキュリティ強化点
- エラーハンドリング改善
- 監視・ログ出力の考慮
```

## 自動品質チェック統合

PR文章生成時に以下を自動実行・結果を含める：
```bash
# コード品質チェック
bundle exec rubocop --format json > rubocop_result.json
bundle exec rspec --format json > rspec_result.json  

# セキュリティチェック
bundle audit check
brakeman -o brakeman_result.json

# パフォーマンス分析 (該当する場合)
rails_best_practices .
```

## AI連携システム説明の自動生成

実装フローに応じて以下を自動判定・説明：
```bash
# Claude単独実装の場合
"このPRはClaude Codeによる実装です"

# Claude-Gemini連携実装の場合  
"このPRはClaude-Gemini自律連携システムで実装されています"
- 連携フロー詳細
- 処理時間実績
- 品質管理プロセス
```

## 使用方法

### Claude Codeでの自動実行
ユーザーが以下のように指示するだけで、高品質なPR文章が自動生成されます：

```
「pushまで行ってください」
「リントチェックも行ってください」
「プルリクまで作成してください」
```

### 実行時のClaude Codeの動作フロー
1. Git差分分析による変更内容の自動抽出
2. コミットメッセージ分析による機能分類判定
3. ファイル種別に応じた詳細説明の自動生成
4. 品質チェック結果の統合
5. テンプレートに基づくPR文章の完成
6. GitHub PR自動作成

## 生成されるPR文章の品質レベル

### Phase3統計機能レベルの自動生成例
- 概要: プロジェクト背景・機能詳細・技術アプローチ（300-500字）
- 変更点: 新規7ファイル・修正3ファイルの詳細説明
- 技術実装: Chart.js・Bootstrap・RESTful設計の説明
- 影響範囲: データベース・依存関係・ルーティングの分析
- 動作確認: 10項目の詳細チェックリスト
- 技術成果: 統計情報・品質指標の数値化

### 小規模修正レベルの自動生成例
- 概要: 修正の背景と目的（100-200字）
- 変更点: 具体的なファイル・行数・修正内容
- 影響範囲: 限定的影響の明確化
- 動作確認: 基本的な3-5項目のチェックリスト

## 品質保証機能

### 自動チェック項目
- RuboCop Lint結果の自動取得・表示
- RSpec テスト結果の自動取得・表示
- セキュリティチェック（該当する場合）
- パフォーマンス影響分析（重要変更時）

### 人間による最終確認項目
- ビジネスロジックの妥当性
- UI/UXの適切性
- セキュリティ脆弱性チェック
- 実機テスト（iOS Safari・Android Chrome）

## コミットメッセージ規約
- **feat**: 新機能追加
- **fix**: バグ修正  
- **refactor**: リファクタリング
- **docs**: ドキュメント更新
- **test**: テスト追加・修正
- **style**: コードスタイル修正

必ず「🤖 Generated with [Claude Code](https://claude.ai/code)」を含めてください。

## 自動レビューポイント識別システム

Claude Codeが実装内容に基づいて、レビュアーが重点的に確認すべきポイントを自動識別・提示：

### 機能別レビューポイント
- **新機能実装**: 機能仕様・ユーザビリティ・エラーハンドリング・パフォーマンス・セキュリティ
- **バグ修正**: 根本原因・副作用・テストケース追加
- **スタイル修正**: コード品質・一貫性・機能影響なし

### ファイル種別別レビューポイント
- **コントローラー**: ビジネスロジック分離・Strong Parameters・例外処理
- **モデル**: バリデーション・アソシエーション・データ整合性
- **ビュー**: XSS対策・アクセシビリティ・レスポンシブ
- **ルーティング**: RESTful設計・セキュリティ考慮

### 技術的重要ポイント
- **Chart.js**: グラフデータ正確性・パフォーマンス・CDN依存
- **複雑クエリ**: SQL性能・N+1問題回避・大量データ影響
- **権限制御**: 適切な実装・権限昇格攻撃防止

この設定により、「pushまで行ってください」の指示だけで、高品質で詳細なPR文章が自動生成されます。